<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles/normalize.css" />
  <link rel="stylesheet" href="styles/skeleton.css" />
  <link rel="stylesheet" href="styles/style.css" />
  <title>Vite App</title>
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="column">
        <!-- <h1>Cute Little App</h1> -->
        <img src="./logo1.png" alt="">
        <h4>ADMIN PORTAL</h4>
      </div>
    </div>

    <div class="row">
      <div class="columns four sidebar-one" id="sidebar-one">
        <h4>Actions</h4>
        <button id="fetch-ingredient" class="u-full-width button button-primary">
          Fetch Ingredients
        </button>
        <button id="fetch-employees" class="u-full-width button button-primary">
          Fetch All Products
        </button>
        <hr />

        <h4>Add Products</h4>
        <input type="text" id="employee-name" class="u-full-width" placeholder="Name" />
        <input type="text" id="employee-image" class="u-full-width" placeholder="Image Url" />
        <!-- <input
            type="number"
            id="employee-dept"
            class="u-full-width"
            placeholder="Department"
          /> -->
        <input type="number" id="employee-salary" class="u-full-width" placeholder="Price" />
        <button id="add-employee" class="u-full-width button button-primary">
          Add Employee
        </button>
        <hr />

        <h4>update all fields of Products</h4>
        <input type="text" id="update-employee-id" class="u-full-width" placeholder="ID" />
        <input type="text" id="update-employee-name" class="u-full-width" placeholder="Title" />
        <input type="text" id="update-employee-image" class="u-full-width" placeholder="Image Url" />
        <!-- <input
            type="number"
            id="update-employee-dept"
            class="u-full-width"
            placeholder="Department"
          /> -->
        <input type="number" id="update-employee-salary" class="u-full-width" placeholder="Price" />
        <button id="update-employee" class="u-full-width button button-primary">
          Update all fields
        </button>
        <hr />

        <h4>update only Price</h4>
        <input type="text" id="update-score-employee-id" class="u-full-width" placeholder="ID" />
        <input type="number" id="update-score-employee-salary" class="u-full-width" placeholder="Price" />
        <button id="update-score-employee" class="u-full-width button button-primary">
          Update Product Price
        </button>
        <hr />

        <h4>Sort Based On Price</h4>
        <button id="sort-low-to-high" class="u-full-width button button-primary">
          Sort Low To High
        </button>
        <button id="sort-high-to-low" class="u-full-width button button-primary">
          Sort High To Low
        </button>
        <!-- <hr /> -->

        <!-- <h4>Filter Based On Salary</h4>
          <button
            id="filter-less-than-1L"
            class="u-full-width button button-primary"
          >
            less than 1L
          </button>
          <button
            id="filter-more-than-equal-1L"
            class="u-full-width button button-primary"
          >
            more than or equal 1L
          </button>
          <hr />



          <hr /> -->
        <!-- 
          <h4>Register User</h4>
          <input type="text" id="register-user-username" class="u-full-width" placeholder="username" />
          <input type="text" id="register-user-firstname" class="u-full-width" placeholder="firstname" />
          <input type="text" id="register-user-lastname" class="u-full-width" placeholder="lastname" />
          <input type="text" id="register-user-email" class="u-full-width" placeholder="email" />
          <input type="password" id="register-user-passowrd" class="u-full-width" placeholder="password" />
          <input type="text" id="register-user-avatar" class="u-full-width" placeholder="avatar image url" value="https://cloudflare-ipfs.com/ipfs/Qmd3W5DuhgHirLHGVixi6V76LhCkZUz6pnFt5AJBiyvHye/avatar/762.jpg"/>
          <input type="number" id="register-user-level" class="u-full-width" placeholder="Department Number" />
          <button id="register-user" class="u-full-width button button-primary">Register User</button>
          <hr> -->

        <!-- <h4>Log in an existing User</h4>
          <input type="text" id="login-user-username" class="u-full-width" placeholder="username" />
          <input type="password" id="login-user-passowrd" class="u-full-width" placeholder="password" />
          <button id="login-user" class="u-full-width button button-primary">Login User</button>
          <hr> -->

        <!-- <button id="fetch-todos" class="u-full-width button button-primary">fetch todos</button> -->
        <!-- <hr> -->

        <!-- <h4>Update User</h4>
          <input type="text" id="update-user-username" class="u-full-width" placeholder="username" />
          <input type="text" id="update-user-firstname" class="u-full-width" placeholder="firstname" />
          <input type="text" id="update-user-lastname" class="u-full-width" placeholder="lastname" />
          <input type="text" id="update-user-email" class="u-full-width" placeholder="email" />
          <input type="password" id="update-user-passowrd" class="u-full-width" placeholder="password" />
          <input type="text" id="update-user-avatar" class="u-full-width" placeholder="avatar image url" value="https://cloudflare-ipfs.com/ipfs/Qmd3W5DuhgHirLHGVixi6V76LhCkZUz6pnFt5AJBiyvHye/avatar/762.jpg"/>
          <input type="number" id="update-user-level" class="u-full-width" placeholder="Department Number" />
          <button id="update-user" class="u-full-width button button-primary">Update User</button>
          <hr> -->

        <!-- <h4>Patch User Department</h4>
          <input type="number" id="patch-user-id" class="u-full-width" placeholder="user id" />
          <input type="text" id="patch-user-username" class="u-full-width" placeholder="username"/>
          <input type="number" id="patch-user-level" class="u-full-width" placeholder="Department Number" />
          <button id="patch-user" class="u-full-width button button-primary">Patch User</button>
          <hr> -->
      </div>

      <div class="columns eight main">
        <div class="notifications-wrapper" id="notifications-wrapper"></div>
        <div class="data-list-wrapper" id="data-list-wrapper"></div>
      </div>

      <div class="pagination-wrapper" id="pagination-wrapper">
        <!-- Append buttons here -->
      </div>
    </div>
  </div>

  <!-- <script src="./scripts/main.js" type="module"></script> -->
  <script>
  
    // register
    let registerUserUsername = document.getElementById("register-user-username");
    let registerUserFirstname = document.getElementById("register-user-firstname");
    let registerUserLastname = document.getElementById("register-user-lastname");
    let registerUserEmail = document.getElementById("register-user-email");
    let registerUserPassword = document.getElementById("register-user-passowrd");
    let registerUserAvatar = document.getElementById("register-user-avatar");
    let registerUserLevel = document.getElementById("register-user-level");
    let registerUserButton = document.getElementById("register-user");

    // login
    let loginUserUsername = document.getElementById("login-user-username");
    let loginUserPassword = document.getElementById("login-user-passowrd");
    let loginUserButton = document.getElementById("login-user");

    // getTodo
    let getTodoButton = document.getElementById("fetch-todos");

    let mainSection = document.getElementById("data-list-wrapper");
    let notificationWrapper = document.getElementById("notifications-wrapper");

    let userAuthToken = localStorage.getItem("localAccessToken") || null;
    let userId = +localStorage.getItem("userId") || null;
    // const urlAllTodosOfUser = `${baseServerURL}/todos?userId=${userId}`;
    // const urlTodosBase = `${baseServerURL}/todos/`;

    // cats
    let empNameInput = document.getElementById("employee-name");
    let empImgInput = document.getElementById("employee-image");
    let empDeptInput = document.getElementById("employee-dept");
    let empSalaryInput = document.getElementById("employee-salary");
    let empCreateBtn = document.getElementById("add-employee");
    let sortAtoZBtn = document.getElementById("sort-low-to-high");
    let sortZtoABtn = document.getElementById("sort-high-to-low");
    let catsData = [];

    // employees
    let updateEmpIdInput = document.getElementById("update-employee-id");
    let updateEmpNameInput = document.getElementById("update-employee-name");
    let updateEmpImageInput = document.getElementById("update-employee-image");
    let updateEmpDeptInput = document.getElementById("update-employee-dept");
    let updateEmpSalaryInput = document.getElementById("update-employee-salary");
    let updateEmpUpdateBtn = document.getElementById("update-employee");

    let updateScoreEmpId = document.getElementById("update-score-employee-id");
    let updateScoreEmpSalary = document.getElementById(
      "update-score-employee-salary"
    );
    let updateScoreEmpSalaryButton = document.getElementById(
      "update-score-employee"
    );

    let productsData = [];

    // ***** Event listeners ***** //


    sortAtoZBtn.addEventListener("click", () => {

    });

    sortZtoABtn.addEventListener("click", () => {

    });

    // empCreateBtn.addEventListener("click", () => {

    // });

    // updateScoreEmpSalaryButton.addEventListener("click", function () {

    // });



    // loginUserButton.addEventListener("click", async function () {

    // });

    // registerUserButton.addEventListener("click", function () {

    // });

    // ***** Utilities ***** //
    // array of objects
    // id, title, desc, linkText, linkUrl, imageUrl
    function renderCardList(cardData) {
      let cardList = `
    <div class="card-list">
      ${cardData
          .map((item) =>
            getCard(
              item.id,
              item.title,
              item.price,
              item.linkText,
              item.linkUrl,
              item.imageUrl
            )
          )
          .join("")}
    </div>
  `;

      mainSection.innerHTML = cardList;
      editDATALinkWithId()
      // let editLinks = document.querySelectorAll(".card__link");
      // for (let editLink of editLinks) {
      //   editLink.addEventListener("click", (e) => {
      //     e.preventDefault();
      //     let currentId = e.target.dataset.id;
      //     populateEditForms(currentId);
      //   });
      // }
    }

    function getCard(id, title, price, linkText, linkUrl, imageUrl) {
      let card = `
      <div class="card" data-id=${id} >
        <div class="card__img">
        <img src=${imageUrl} alt="food" />
        </div>
        <div class="card__body">
          <h3 class="card__item card__title">${title}</h3>
          <div class="card__item card__description">
            ${price}
          </div>
          <a href=${linkUrl} data-id=${id} class="card__item card__link">${linkText}</a>
        </div>
      </div>
  `;
      return card;
    }



    /***************------------------ Employee FETCH on window load  -------------******************/


    // // ***** Event listeners ***** //
    // window.addEventListener("load", () => {
    //   fetchAndRenderProducts();
    // });

    // async function fetchAndRenderProducts(pageNumber) {
    //   try {
    //     let res = await fetch(`http://127.0.0.1:9090/Products1?_limit=10&_page=${pageNumber}`)
    //     let data = await res.json()
    //     // console.log(data)
    //     let productObj = data.map((item) => ({
    //       id: item.id,
    //       title: item.title,
    //       price: item.price,
    //       linkText: "Edit",
    //       // linkUrl: "https://www.google.com",
    //       imageUrl: `${item.image}`
    //     }));

    //     let totalUsers = res.headers.get("X-Total-Count")
    //     showPagination(totalUsers, 10)
    //     productsData = data
    //     renderCardList(productObj)
    //   } catch (error) {
    //     console.log(error)
    //   }
    // }





    /************--------------- fetch employees with Button CLICK  ----------**************/


    let fetchEmployeeData = document.getElementById("fetch-employees")
    fetchEmployeeData.addEventListener("click", fetchAndRenderProducts);

    async function fetchAndRenderProducts(pageNumber) {
      try {
        let res = await fetch(`http://127.0.0.1:9090/Products1?_limit=10&_page=${pageNumber}`)
        let data = await res.json()
        // console.log(data)
        let productObj = data.map((item) => ({
          id: item.id,
          title: item.title,
          price: `$${item.price}`,
          linkText: "Edit",
          imageUrl: `${item.image}`
        }));
        let totalUsers = res.headers.get("X-Total-Count")
        showPagination(totalUsers, 10)
        productsData = data
        renderCardList(productObj)
      } catch (error) {
        console.log(error)
      }
    }


    /***************------------------ Pagination on Window Load  -------------******************/

    let paginationWrapper = document.querySelector(".pagination-wrapper")

    function showPagination(totalItems, limit) {
      let numberOfPages = Math.ceil(totalItems / limit)

      let btn_Arr = []

      for (let i = 1; i <= numberOfPages; i++) {
        btn_Arr.push(`<button class="pagination-button" data-page-number='${i}'>${i}</button>`)
      }

      paginationWrapper.innerHTML = btn_Arr.join("")

      let paginationButtons = document.querySelectorAll(".pagination-button")

      for (let btn of paginationButtons) {
        btn.addEventListener("click", (e) => {
          let pageNumber = e.target.dataset['pageNumber']
          // console.log(pageNumber)
          fetchAndRenderProducts(pageNumber)
        })
      }
    }


    // Edit click Link

    function editDATALinkWithId() {
      let editLinks = document.querySelectorAll(".card__link");
      // capturing all link click
      for (let editLink of editLinks) {
        editLink.addEventListener("click", whenClicked)
        // console.log("***********")
      }
    }

    // function which is bringing information in the update cardBox
    async function whenClicked(event) {
      event.preventDefault()
      let id = event.target.dataset.id
      // console.log(id)  Getting Id of employees here

      let response = await fetch(`http://127.0.0.1:9090/Products1/${id}`)
      let data = await response.json()

      updateEmpIdInput.value = data.id
      updateEmpNameInput.value = data.title
      updateEmpImageInput.value = data.image
      // updateEmpDeptInput.value = data.price
      updateEmpSalaryInput.value = data.price
    }


    //function to finally update
    async function updateAfterClicked() {
      let obj = {
        id: updateEmpIdInput.value,
        title: updateEmpNameInput.value,
        image: updateEmpImageInput.value,
        // department: updateEmpDeptInput.value,
        price: updateEmpSalaryInput.value,
      }

      let response = await fetch(`http://127.0.0.1:9090/Products1/${obj.id}`, {
        method: "PUT",
        body: JSON.stringify(obj),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      let data = await response.json()
      console.log(data)
      window.location.reload()
    }

    updateEmpUpdateBtn.addEventListener("click", function () {
      updateAfterClicked()
    });



    /*********************----------------- UPDATE only PRICE -------------*********************/


    updateScoreEmpSalaryButton.addEventListener("click", function (e) {
      e.preventDefault()

      let id = updateScoreEmpId.value;
      let price = updateScoreEmpSalary.value;
      updateSalary(id, price)
      alert("Updated Employee Data")
      fetchAndRenderProducts();
    });

    function updateSalary(id, price) {
      fetch(`http://127.0.0.1:9090/Products1/${id}`, {
        method: "PATCH",
        body: JSON.stringify({
          price: price,
        }),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      window.location.reload()
    }


    /*********************----------------- ADD PRODUCTS------------*********************/


    empCreateBtn.addEventListener("click", (e) => {
      e.preventDefault()
      AddProducts()
      // console.log("*******")

    });
    // we need to create an object / we need make a POST request

    async function AddProducts() {

      let userObj = {
        title: empNameInput.value,
        image: empImgInput.value,
        price: +empSalaryInput.value
      }

      let response = await fetch(`http://127.0.0.1:9090/Products1`, {
        method: "POST",  //get is by default but here we want to POST
        body: JSON.stringify(userObj),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      let data = await response.json()
      console.log(data)
      alert("Added")
      window.location.reload()
    }

  </script>
</body>

</html>